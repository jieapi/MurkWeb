import{_ as be}from"./_plugin-vue_export-helper-c27b6911.js";import{r as c,a as J,l as ge,b as u,R as Ie,o as z,c as K,d as o,e,w as t,f as d,v as Te,i as L,t as k,F as ye,h as Ve,T as Ce,E as x}from"./index-baac4e90.js";const xe={class:"token-management"},we={class:"card-header"},he={class:"token-value"},Me={class:"pagination-container"},Ue={class:"dialog-footer"},Je={class:"new-token-info"},ze={class:"token-display"},Oe={class:"dialog-footer"},Ae={class:"token-value"},De={__name:"Tokens",setup(je){const w=c(!1),O=c(!1),I=c(!1),A=c("生成Token"),h=c(!1),D=c(!1),M=c(0),C=c(),j=c(""),m=J({id:null,token:"",username:"",name:"",callCount:0,lastUsedAt:"",status:"enabled",createdAt:"",remark:""}),f=J({token:"",username:"",status:""}),v=J({currentPage:1,pageSize:20}),s=J({id:null,username:"",name:"",status:"enabled",remark:""}),X={username:[{required:!0,message:"请选择用户",trigger:"change"}],name:[{required:!0,message:"请输入Token名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}]},b=c([]),Z=c([{value:"superadmin",label:"superadmin (超级管理员)"},{value:"admin",label:"admin (管理员)"},{value:"agent001",label:"agent001 (代理商)"},{value:"user001",label:"user001 (普通用户)"},{value:"user002",label:"user002 (普通用户)"},{value:"user003",label:"user003 (普通用户)"}]),R=[{id:1,token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c",username:"superadmin",name:"管理后台Token",callCount:256,lastUsedAt:"2024-01-15 10:30:25",status:"enabled",createdAt:"2024-01-01 09:00:00",remark:"超级管理员使用的Token"},{id:2,token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkphbmUgRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.cThIIoDvwdueQB468K5xDc5633seEFoqwxjF_xSJyQQ",username:"admin",name:"接口管理Token",callCount:128,lastUsedAt:"2024-01-14 15:20:10",status:"enabled",createdAt:"2024-01-02 10:30:00",remark:"管理员使用的Token"},{id:3,token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkJvYiBTbWl0aCIsImlhdCI6MTUxNjIzOTAyMn0.8V6ckVz_V3ZJJHBpQaRlNWEhO5vLgX6L5E-7VB_L5Ks",username:"agent001",name:"代理商Token",callCount:532,lastUsedAt:"2024-01-15 09:15:30",status:"enabled",createdAt:"2024-01-03 14:20:00",remark:"代理商使用的Token"},{id:4,token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkFsaWNlIEJyb3duIiwiaWF0IjoxNTE2MjM5MDIyfQ.MYj3fqOQJpg0YVHjCNLgJZ8J9QQK-Kov0TVnw-VIT_Y",username:"user001",name:"用户Token",callCount:78,lastUsedAt:"2024-01-14 16:45:30",status:"enabled",createdAt:"2024-01-04 16:45:00",remark:"普通用户使用的Token"},{id:5,token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkNoYXJsaWUgV2lsc29uIiwiaWF0IjoxNTE2MjM5MDIyfQ.RIrK8BMwQgDyUM3vO5uPVVGfBXbGIkbmIKCAnqOn_Fw",username:"user002",name:"测试Token",callCount:0,lastUsedAt:null,status:"disabled",createdAt:"2024-01-10 11:20:15",remark:"测试用的Token"}],y=()=>{w.value=!0,setTimeout(()=>{b.value=R,M.value=R.length,w.value=!1},500)},q=()=>{v.currentPage=1,y()},H=()=>{Object.assign(f,{token:"",username:"",status:""}),v.currentPage=1,y()},ee=()=>{y()},le=()=>{A.value="生成Token",Q(),I.value=!0},te=n=>{A.value="编辑Token",Object.assign(s,{id:n.id,username:n.username,name:n.name,status:n.status,remark:n.remark}),I.value=!0},ae=n=>{Object.assign(m,n),D.value=!0},ne=async n=>{try{await Ce.confirm(`确定要删除Token "${n.name}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const l=b.value.findIndex(i=>i.id===n.id);l>-1&&(b.value.splice(l,1),M.value--,x.success("删除成功"))}catch{}},oe=n=>{const l=n.status==="enabled"?"启用":"禁用";x.success(`Token "${n.name}" 已${l}`)},se=async()=>{C.value&&await C.value.validate(n=>{n&&(O.value=!0,setTimeout(()=>{if(O.value=!1,s.id){const l=b.value.findIndex(i=>i.id===s.id);if(l>-1){const i={...b.value[l],username:s.username,name:s.name,status:s.status,remark:s.remark};b.value[l]=i,x.success("编辑成功")}I.value=!1}else{const l=ue();j.value=l;const i={id:Date.now(),token:l,username:s.username,name:s.name,callCount:0,lastUsedAt:null,status:s.status,createdAt:new Date().toLocaleString("zh-CN"),remark:s.remark};b.value.unshift(i),M.value++,I.value=!1,h.value=!0}},1e3))})},B=()=>{I.value=!1,Q()},Q=()=>{Object.assign(s,{id:null,username:"",name:"",status:"enabled",remark:""}),C.value&&C.value.resetFields()},E=n=>n?n.substring(0,10)+"..."+n.substring(n.length-10):"",N=n=>{navigator.clipboard.writeText(n).then(()=>{x.success("Token已复制到剪贴板")}).catch(()=>{x.error("复制失败，请手动复制")})},ue=()=>{const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let i="";for(let p=0;p<32;p++)i+=n.charAt(Math.floor(Math.random()*n.length));return`mphp_${i}`},de=n=>{v.pageSize=n,y()},ie=n=>{v.currentPage=n,y()};return ge(()=>{y()}),(n,l)=>{const i=u("el-input"),p=u("el-form-item"),U=u("el-option"),W=u("el-select"),re=u("Search"),T=u("el-icon"),r=u("el-button"),P=u("Refresh"),me=u("Plus"),$=u("el-form"),G=u("el-card"),_=u("el-table-column"),pe=u("el-tooltip"),F=u("CopyDocument"),Y=u("el-switch"),ce=u("el-table"),ke=u("el-pagination"),S=u("el-dialog"),g=u("el-descriptions-item"),_e=u("el-tag"),fe=u("el-descriptions"),ve=Ie("loading");return z(),K("div",xe,[l[29]||(l[29]=o("h1",{class:"page-title"},"Token管理",-1)),e(G,{class:"search-card"},{default:t(()=>[e($,{model:f,inline:""},{default:t(()=>[e(p,{label:"Token"},{default:t(()=>[e(i,{modelValue:f.token,"onUpdate:modelValue":l[0]||(l[0]=a=>f.token=a),placeholder:"请输入Token",style:{width:"200px"},clearable:""},null,8,["modelValue"])]),_:1}),e(p,{label:"用户名"},{default:t(()=>[e(i,{modelValue:f.username,"onUpdate:modelValue":l[1]||(l[1]=a=>f.username=a),placeholder:"请输入用户名",style:{width:"200px"},clearable:""},null,8,["modelValue"])]),_:1}),e(p,{label:"状态"},{default:t(()=>[e(W,{modelValue:f.status,"onUpdate:modelValue":l[2]||(l[2]=a=>f.status=a),placeholder:"全部状态",clearable:"",style:{width:"120px"}},{default:t(()=>[e(U,{label:"全部状态",value:""}),e(U,{label:"启用",value:"enabled"}),e(U,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),e(p,null,{default:t(()=>[e(r,{type:"primary",onClick:q,loading:w.value},{default:t(()=>[e(T,null,{default:t(()=>[e(re)]),_:1}),l[15]||(l[15]=d(" 搜索 ",-1))]),_:1,__:[15]},8,["loading"]),e(r,{onClick:H},{default:t(()=>[e(T,null,{default:t(()=>[e(P)]),_:1}),l[16]||(l[16]=d(" 重置 ",-1))]),_:1,__:[16]}),e(r,{type:"success",onClick:le},{default:t(()=>[e(T,null,{default:t(()=>[e(me)]),_:1}),l[17]||(l[17]=d(" 生成Token ",-1))]),_:1,__:[17]})]),_:1})]),_:1},8,["model"])]),_:1}),e(G,null,{header:t(()=>[o("div",we,[l[19]||(l[19]=o("span",null,"Token列表",-1)),o("div",null,[e(r,{type:"primary",size:"small",onClick:ee},{default:t(()=>[e(T,null,{default:t(()=>[e(P)]),_:1}),l[18]||(l[18]=d(" 刷新 ",-1))]),_:1,__:[18]})])])]),default:t(()=>[Te((z(),L(ce,{data:b.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(_,{prop:"id",label:"ID",width:"80"}),e(_,{prop:"token",label:"Token",width:"280"},{default:t(({row:a})=>[o("div",he,[e(pe,{content:a.token,placement:"top"},{default:t(()=>[o("span",null,k(E(a.token)),1)]),_:2},1032,["content"]),e(r,{type:"text",onClick:V=>N(a.token)},{default:t(()=>[e(T,null,{default:t(()=>[e(F)]),_:1})]),_:2},1032,["onClick"])])]),_:1}),e(_,{prop:"username",label:"所属用户",width:"120"}),e(_,{prop:"name",label:"Token名称",width:"150"}),e(_,{prop:"callCount",label:"调用次数",width:"100"}),e(_,{prop:"lastUsedAt",label:"最后使用",width:"160"},{default:t(({row:a})=>[d(k(a.lastUsedAt||"未使用"),1)]),_:1}),e(_,{prop:"status",label:"状态",width:"100"},{default:t(({row:a})=>[e(Y,{modelValue:a.status,"onUpdate:modelValue":V=>a.status=V,"active-value":"enabled","inactive-value":"disabled",onChange:V=>oe(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(_,{prop:"createdAt",label:"创建时间",width:"160"}),e(_,{label:"操作",width:"200",fixed:"right"},{default:t(({row:a})=>[e(r,{type:"text",size:"small",onClick:V=>te(a)},{default:t(()=>l[20]||(l[20]=[d(" 编辑 ",-1)])),_:2,__:[20]},1032,["onClick"]),e(r,{type:"text",size:"small",onClick:V=>ae(a),style:{color:"#67c23a"}},{default:t(()=>l[21]||(l[21]=[d(" 查看 ",-1)])),_:2,__:[21]},1032,["onClick"]),e(r,{type:"text",size:"small",onClick:V=>ne(a),style:{color:"#f56c6c"}},{default:t(()=>l[22]||(l[22]=[d(" 删除 ",-1)])),_:2,__:[22]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ve,w.value]]),o("div",Me,[e(ke,{"current-page":v.currentPage,"onUpdate:currentPage":l[3]||(l[3]=a=>v.currentPage=a),"page-size":v.pageSize,"onUpdate:pageSize":l[4]||(l[4]=a=>v.pageSize=a),"page-sizes":[10,20,50,100],total:M.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:de,onCurrentChange:ie},null,8,["current-page","page-size","total"])])]),_:1}),e(S,{modelValue:I.value,"onUpdate:modelValue":l[9]||(l[9]=a=>I.value=a),title:A.value,width:"500px","before-close":B},{footer:t(()=>[o("span",Ue,[e(r,{onClick:B},{default:t(()=>l[23]||(l[23]=[d("取消",-1)])),_:1,__:[23]}),e(r,{type:"primary",onClick:se,loading:O.value},{default:t(()=>l[24]||(l[24]=[d(" 确定 ",-1)])),_:1,__:[24]},8,["loading"])])]),default:t(()=>[e($,{ref_key:"tokenFormRef",ref:C,model:s,rules:X,"label-width":"100px"},{default:t(()=>[e(p,{label:"所属用户",prop:"username"},{default:t(()=>[e(W,{modelValue:s.username,"onUpdate:modelValue":l[5]||(l[5]=a=>s.username=a),placeholder:"请选择用户",filterable:"",style:{width:"100%"}},{default:t(()=>[(z(!0),K(ye,null,Ve(Z.value,a=>(z(),L(U,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"Token名称",prop:"name"},{default:t(()=>[e(i,{modelValue:s.name,"onUpdate:modelValue":l[6]||(l[6]=a=>s.name=a),placeholder:"请输入Token名称"},null,8,["modelValue"])]),_:1}),e(p,{label:"状态",prop:"status"},{default:t(()=>[e(Y,{modelValue:s.status,"onUpdate:modelValue":l[7]||(l[7]=a=>s.status=a),"active-value":"enabled","inactive-value":"disabled","active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),e(p,{label:"备注"},{default:t(()=>[e(i,{modelValue:s.remark,"onUpdate:modelValue":l[8]||(l[8]=a=>s.remark=a),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(S,{modelValue:h.value,"onUpdate:modelValue":l[12]||(l[12]=a=>h.value=a),title:"Token生成成功",width:"500px"},{footer:t(()=>[o("span",Oe,[e(r,{type:"primary",onClick:l[11]||(l[11]=a=>h.value=!1)},{default:t(()=>l[28]||(l[28]=[d(" 我已保存 ",-1)])),_:1,__:[28]})])]),default:t(()=>[o("div",Je,[l[26]||(l[26]=o("p",{class:"warning-text"},"请保存好您的Token，它只会显示一次！",-1)),o("div",ze,[o("span",null,k(j.value),1),e(r,{type:"primary",size:"small",onClick:l[10]||(l[10]=a=>N(j.value))},{default:t(()=>[e(T,null,{default:t(()=>[e(F)]),_:1}),l[25]||(l[25]=d(" 复制 ",-1))]),_:1,__:[25]})]),l[27]||(l[27]=o("div",{class:"token-tips"},[o("p",null,"使用说明："),o("ol",null,[o("li",null,[d("在API请求头中添加："),o("code",null,"Authorization: Bearer {token}")]),o("li",null,[d("或在请求参数中添加："),o("code",null,"token={token}")])])],-1))])]),_:1},8,["modelValue"]),e(S,{modelValue:D.value,"onUpdate:modelValue":l[14]||(l[14]=a=>D.value=a),title:"Token详情",width:"500px"},{default:t(()=>[e(fe,{column:1,border:""},{default:t(()=>[e(g,{label:"Token"},{default:t(()=>[o("div",Ae,[o("span",null,k(E(m.token)),1),e(r,{type:"text",onClick:l[13]||(l[13]=a=>N(m.token))},{default:t(()=>[e(T,null,{default:t(()=>[e(F)]),_:1})]),_:1})])]),_:1}),e(g,{label:"所属用户"},{default:t(()=>[d(k(m.username),1)]),_:1}),e(g,{label:"Token名称"},{default:t(()=>[d(k(m.name),1)]),_:1}),e(g,{label:"调用次数"},{default:t(()=>[d(k(m.callCount),1)]),_:1}),e(g,{label:"最后使用"},{default:t(()=>[d(k(m.lastUsedAt||"未使用"),1)]),_:1}),e(g,{label:"状态"},{default:t(()=>[e(_e,{type:m.status==="enabled"?"success":"danger"},{default:t(()=>[d(k(m.status==="enabled"?"启用":"禁用"),1)]),_:1},8,["type"])]),_:1}),e(g,{label:"创建时间"},{default:t(()=>[d(k(m.createdAt),1)]),_:1}),e(g,{label:"备注"},{default:t(()=>[d(k(m.remark||"-"),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Se=be(De,[["__scopeId","data-v-9ae347e7"]]);export{Se as default};
