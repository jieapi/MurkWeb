import{_ as re}from"./_plugin-vue_export-helper-c27b6911.js";import{r as u,a as P,l as ue,b as a,R as me,o as j,c as ce,d as f,e as l,w as t,f as d,t as D,v as pe,i as _e,E as C,T as E}from"./index-1093a8fd.js";const fe={class:"user-roles"},ge={class:"card-header"},ve={class:"pagination-container"},be={class:"dialog-footer"},ye={__name:"Roles",setup(Ce){const w=u(!1),S=u(!1),V=u(!1),k=u("add"),A=u("添加角色"),g=u([]),v=u(0),x=u();u({});const b=P({name:"",isAdmin:""}),p=P({currentPage:1,pageSize:20}),s=P({id:null,name:"",description:"",isAdmin:!1,discount:100,isSystem:!1,remark:""}),M={name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"}],discount:[{required:!0,message:"请输入折扣百分比",trigger:"blur"},{type:"number",min:1,max:100,message:"折扣必须在1-100之间",trigger:"blur"}]},r=u([]),B=[{id:1,name:"超级管理员",description:"系统最高权限管理员",isAdmin:!0,discount:100,userCount:1,createdAt:"2024-01-01 09:00:00",isSystem:!0,remark:"系统内置角色，不可删除"},{id:2,name:"普通管理员",description:"具有管理权限的管理员",isAdmin:!0,discount:95,userCount:3,createdAt:"2024-01-01 09:00:00",isSystem:!1,remark:"管理员角色"},{id:3,name:"VIP用户",description:"VIP会员用户，享受优惠折扣",isAdmin:!1,discount:80,userCount:25,createdAt:"2024-01-02 10:30:00",isSystem:!1,remark:"VIP会员专享8折优惠"},{id:4,name:"普通用户",description:"系统默认用户角色",isAdmin:!1,discount:100,userCount:156,createdAt:"2024-01-01 09:00:00",isSystem:!0,remark:"系统默认角色，不可删除"},{id:5,name:"代理商",description:"代理商用户，享受代理价格",isAdmin:!1,discount:70,userCount:12,createdAt:"2024-01-05 14:20:30",isSystem:!1,remark:"代理商专享7折优惠"},{id:6,name:"企业用户",description:"企业客户，享受企业折扣",isAdmin:!1,discount:85,userCount:8,createdAt:"2024-01-08 16:45:20",isSystem:!1,remark:"企业客户专享85折优惠"}],y=()=>{w.value=!0,setTimeout(()=>{r.value=B,v.value=B.length,w.value=!1},500)},N=()=>{p.currentPage=1,y()},O=()=>{Object.assign(b,{name:"",isAdmin:""}),p.currentPage=1,y()},$=()=>{y()},q=()=>{k.value="add",A.value="添加角色",U(),V.value=!0},L=o=>{k.value="edit",A.value="编辑角色",Object.assign(s,o),V.value=!0},G=async o=>{if(o.isSystem){C.warning("系统角色不可删除");return}try{await E.confirm(`确定要删除角色 "${o.name}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=r.value.findIndex(i=>i.id===o.id);e>-1&&(r.value.splice(e,1),v.value--,C.success("删除成功"))}catch{}},H=async()=>{if(g.value.filter(e=>e.isSystem).length>0){C.warning("选中的角色中包含系统角色，无法删除");return}try{await E.confirm(`确定要删除选中的 ${g.value.length} 个角色吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=g.value.map(i=>i.id);r.value=r.value.filter(i=>!e.includes(i.id)),v.value=r.value.length,g.value=[],C.success("批量删除成功")}catch{}},J=o=>{g.value=o},K=async()=>{x.value&&await x.value.validate(o=>{o&&(S.value=!0,setTimeout(()=>{if(S.value=!1,k.value==="add"){const e={...s,id:Date.now(),userCount:0,createdAt:new Date().toLocaleString("zh-CN")};r.value.unshift(e),v.value++,C.success("添加成功")}else{const e=r.value.findIndex(i=>i.id===s.id);e>-1&&(Object.assign(r.value[e],s),C.success("编辑成功"))}R()},1e3))})},R=()=>{V.value=!1,U()},U=()=>{Object.assign(s,{id:null,name:"",description:"",isAdmin:!1,discount:100,isSystem:!1,remark:""}),x.value&&x.value.resetFields()},Q=o=>{p.pageSize=o,y()},W=o=>{p.currentPage=o,y()};return ue(()=>{y()}),(o,e)=>{const i=a("el-input"),_=a("el-form-item"),z=a("el-option"),X=a("el-select"),Y=a("Search"),h=a("el-icon"),m=a("el-button"),T=a("Refresh"),Z=a("Plus"),I=a("el-form"),F=a("el-card"),ee=a("Delete"),c=a("el-table-column"),le=a("el-tag"),te=a("el-table"),ne=a("el-pagination"),ae=a("el-switch"),se=a("el-input-number"),oe=a("el-dialog"),ie=me("loading");return j(),ce("div",fe,[e[21]||(e[21]=f("h1",{class:"page-title"},"用户角色",-1)),l(F,{class:"search-card"},{default:t(()=>[l(I,{model:b,inline:""},{default:t(()=>[l(_,{label:"角色名称"},{default:t(()=>[l(i,{modelValue:b.name,"onUpdate:modelValue":e[0]||(e[0]=n=>b.name=n),placeholder:"请输入角色名称",style:{width:"200px"},clearable:""},null,8,["modelValue"])]),_:1}),l(_,{label:"管理员权限"},{default:t(()=>[l(X,{modelValue:b.isAdmin,"onUpdate:modelValue":e[1]||(e[1]=n=>b.isAdmin=n),placeholder:"全部角色",clearable:"",style:{width:"120px"}},{default:t(()=>[l(z,{label:"全部角色",value:""}),l(z,{label:"管理员",value:"true"}),l(z,{label:"普通用户",value:"false"})]),_:1},8,["modelValue"])]),_:1}),l(_,null,{default:t(()=>[l(m,{type:"primary",onClick:N,loading:w.value},{default:t(()=>[l(h,null,{default:t(()=>[l(Y)]),_:1}),e[10]||(e[10]=d(" 搜索 ",-1))]),_:1,__:[10]},8,["loading"]),l(m,{onClick:O},{default:t(()=>[l(h,null,{default:t(()=>[l(T)]),_:1}),e[11]||(e[11]=d(" 重置 ",-1))]),_:1,__:[11]}),l(m,{type:"success",onClick:q},{default:t(()=>[l(h,null,{default:t(()=>[l(Z)]),_:1}),e[12]||(e[12]=d(" 添加角色 ",-1))]),_:1,__:[12]})]),_:1})]),_:1},8,["model"])]),_:1}),l(F,null,{header:t(()=>[f("div",ge,[f("span",null,"角色列表 (共 "+D(v.value)+" 个角色)",1),f("div",null,[l(m,{type:"danger",size:"small",disabled:g.value.length===0,onClick:H},{default:t(()=>[l(h,null,{default:t(()=>[l(ee)]),_:1}),e[13]||(e[13]=d(" 批量删除 ",-1))]),_:1,__:[13]},8,["disabled"]),l(m,{type:"primary",size:"small",onClick:$},{default:t(()=>[l(h,null,{default:t(()=>[l(T)]),_:1}),e[14]||(e[14]=d(" 刷新 ",-1))]),_:1,__:[14]})])])]),default:t(()=>[pe((j(),_e(te,{data:r.value,stripe:"",style:{width:"100%"},onSelectionChange:J},{default:t(()=>[l(c,{type:"selection",width:"55"}),l(c,{prop:"id",label:"ID",width:"80"}),l(c,{prop:"name",label:"角色名称",width:"150"}),l(c,{prop:"description",label:"角色描述","min-width":"200"}),l(c,{prop:"isAdmin",label:"管理员权限",width:"120",align:"center"},{default:t(({row:n})=>[l(le,{type:n.isAdmin?"danger":"success"},{default:t(()=>[d(D(n.isAdmin?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"discount",label:"折扣",width:"100",align:"center"},{default:t(({row:n})=>[d(D(n.discount)+"% ",1)]),_:1}),l(c,{prop:"userCount",label:"用户数量",width:"100",align:"center"}),l(c,{prop:"createdAt",label:"创建时间",width:"160"}),l(c,{label:"操作",width:"160",fixed:"right"},{default:t(({row:n})=>[l(m,{type:"text",size:"small",onClick:de=>L(n)},{default:t(()=>e[15]||(e[15]=[d(" 编辑 ",-1)])),_:2,__:[15]},1032,["onClick"]),l(m,{type:"text",size:"small",onClick:de=>G(n),disabled:n.isSystem,style:{color:"#f56c6c"}},{default:t(()=>e[16]||(e[16]=[d(" 删除 ",-1)])),_:2,__:[16]},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[ie,w.value]]),f("div",ve,[l(ne,{"current-page":p.currentPage,"onUpdate:currentPage":e[2]||(e[2]=n=>p.currentPage=n),"page-size":p.pageSize,"onUpdate:pageSize":e[3]||(e[3]=n=>p.pageSize=n),"page-sizes":[10,20,50,100],total:v.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Q,onCurrentChange:W},null,8,["current-page","page-size","total"])])]),_:1}),l(oe,{modelValue:V.value,"onUpdate:modelValue":e[9]||(e[9]=n=>V.value=n),title:A.value,width:"500px","before-close":R},{footer:t(()=>[f("span",be,[l(m,{onClick:R},{default:t(()=>e[19]||(e[19]=[d("取消",-1)])),_:1,__:[19]}),l(m,{type:"primary",onClick:K,loading:S.value},{default:t(()=>e[20]||(e[20]=[d(" 确定 ",-1)])),_:1,__:[20]},8,["loading"])])]),default:t(()=>[l(I,{ref_key:"roleFormRef",ref:x,model:s,rules:M,"label-width":"100px"},{default:t(()=>[l(_,{label:"角色名称",prop:"name"},{default:t(()=>[l(i,{modelValue:s.name,"onUpdate:modelValue":e[4]||(e[4]=n=>s.name=n),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),l(_,{label:"角色描述",prop:"description"},{default:t(()=>[l(i,{modelValue:s.description,"onUpdate:modelValue":e[5]||(e[5]=n=>s.description=n),type:"textarea",rows:3,placeholder:"请输入角色描述"},null,8,["modelValue"])]),_:1}),l(_,{label:"管理员权限"},{default:t(()=>[l(ae,{modelValue:s.isAdmin,"onUpdate:modelValue":e[6]||(e[6]=n=>s.isAdmin=n),"active-text":"管理员","inactive-text":"普通用户",disabled:s.isSystem},null,8,["modelValue","disabled"]),e[17]||(e[17]=f("div",{class:"form-tip"},"管理员可以访问后台管理功能",-1))]),_:1,__:[17]}),l(_,{label:"折扣",prop:"discount"},{default:t(()=>[l(se,{modelValue:s.discount,"onUpdate:modelValue":e[7]||(e[7]=n=>s.discount=n),min:1,max:100,precision:0,placeholder:"请输入折扣百分比",style:{width:"100%"}},null,8,["modelValue"]),e[18]||(e[18]=f("div",{class:"form-tip"},"用户购买服务时的折扣百分比（1-100）",-1))]),_:1,__:[18]}),l(_,{label:"备注"},{default:t(()=>[l(i,{modelValue:s.remark,"onUpdate:modelValue":e[8]||(e[8]=n=>s.remark=n),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},he=re(ye,[["__scopeId","data-v-a03fdd3c"]]);export{he as default};
