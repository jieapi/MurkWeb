import{r as p,a as A,j as se,k as te,l as oe,m as le,c as _,o as w,d as s,e as o,w as l,b as y,f as b,n as v,p as I,q as L,t as x,u as ae,g as M,F as re,h as ie,s as ne,v as de,x as ue,E as z}from"./index-BEccWB-n.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const fe={class:"forgot-password-container"},pe={class:"main-content"},ve={class:"forgot-box"},me={class:"logo-section"},ge={class:"logo-wrapper"},_e={class:"logo-icon"},we={class:"steps-indicator"},ye={class:"form-section"},be={key:0,class:"step-content"},he={key:1,class:"step-content"},ke={class:"form-header"},Ce={class:"code-input-container"},Pe=["onUpdate:modelValue","onInput","onKeydown"],Ve={class:"code-actions"},Fe={key:2,class:"step-content"},Ie={class:"password-strength"},xe={class:"strength-bar"},ze={key:3,class:"step-content success-content"},Re={class:"success-icon"},De={key:4,class:"form-footer"},Te={class:"back-link"},$e={__name:"ForgotPassword",setup(Ee){const Z=ae(),T=p(),$=p(),E=p(),d=p(!1),a=p(1),k=p(0),S=p(""),n=p(["","","","","",""]),u=p([]);let R=null;const H=(t,e)=>{const r=e.target.value;if(!/^\d*$/.test(r)){n.value[t]="";return}n.value[t]=r,r&&t<5&&u.value[t+1]?.focus(),C.code=n.value.join(""),C.code.length===6&&X()},G=(t,e)=>{e.key==="Backspace"&&!n.value[t]&&t>0&&u.value[t-1]?.focus(),e.key==="ArrowLeft"&&t>0&&u.value[t-1]?.focus(),e.key==="ArrowRight"&&t<5&&u.value[t+1]?.focus()},J=t=>{t.preventDefault(),t.clipboardData.getData("text").replace(/\D/g,"").slice(0,6).split("").forEach((h,c)=>{c<6&&(n.value[c]=h)});const g=n.value.findIndex(h=>!h),K=g===-1?5:g;u.value[K]?.focus(),C.code=n.value.join("")},m=A({identifier:""}),O={identifier:[{required:!0,message:"请输入用户名或邮箱地址",trigger:"blur"},{min:3,message:"至少输入3个字符",trigger:"blur"}]},C=A({code:""}),Q={code:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:6,message:"验证码为6位数字",trigger:"blur"},{pattern:/^\d{6}$/,message:"验证码只能是数字",trigger:"blur"}]},i=A({password:"",confirmPassword:""}),W={password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d@$!%*?&]{6,}$/,message:"密码必须包含大小写字母和数字",trigger:"blur"}],confirmPassword:[{validator:(t,e,r)=>{e===""?r(new Error("请再次输入密码")):e!==i.password?r(new Error("两次输入密码不一致")):r()},trigger:"blur"}]},D=se(()=>{const t=i.password;if(!t)return{level:"weak",width:"0%",text:""};let e=0;return t.length>=8&&(e+=1),t.length>=12&&(e+=1),/[a-z]/.test(t)&&(e+=1),/[A-Z]/.test(t)&&(e+=1),/\d/.test(t)&&(e+=1),/[!@#$%^&*(),.?":{}|<>]/.test(t)&&(e+=1),e<=2?{level:"weak",width:"33%",text:"弱"}:e<=4?{level:"medium",width:"66%",text:"中等"}:{level:"strong",width:"100%",text:"强"}}),B=async t=>{t&&t.preventDefault(),!(!T.value||!m.identifier)&&await T.value.validate(e=>{e&&(d.value=!0,setTimeout(()=>{d.value=!1;const r=m.identifier;r.includes("@")?S.value=r.replace(/(.{2}).*(@.*)/,"$1***$2"):S.value=r.replace(/(.{2}).*(.{2})/,"$1***$2"),z.success("验证码已发送"),a.value=2,N()},1e3))})},X=async()=>{$.value&&await $.value.validate(t=>{t&&(d.value=!0,setTimeout(()=>{d.value=!1,C.code==="123456"?(z.success("验证码正确"),a.value=3):(z.error("验证码错误，请重新输入"),n.value=["","","","","",""],C.code="",setTimeout(()=>{u.value[0]?.focus()},100))},1e3))})},U=async()=>{E.value&&await E.value.validate(t=>{t&&(d.value=!0,setTimeout(()=>{d.value=!1,z.success("密码重置成功"),a.value=4},1500))})},Y=()=>{z.success("验证码已重新发送"),N()},N=()=>{k.value=60,R=setInterval(()=>{k.value--,k.value<=0&&clearInterval(R)},1e3)},j=()=>{Z.push("/login")};return te(a,t=>{setTimeout(()=>{if(t===1){const e=document.querySelector(".form-input input");e&&e.focus()}else t===2&&u.value[0]&&u.value[0].focus()},100)}),oe(()=>{setTimeout(()=>{const t=document.querySelector(".form-input input");t&&t.focus()},100)}),le(()=>{R&&clearInterval(R)}),(t,e)=>{const r=y("Lock"),g=y("el-icon"),K=y("User"),h=y("el-input"),c=y("el-form-item"),F=y("el-button"),q=y("el-form"),ee=y("CircleCheck");return w(),_("div",fe,[e[20]||(e[20]=s("div",{class:"geometric-bg"},[s("div",{class:"geo-shape geo-1"}),s("div",{class:"geo-shape geo-2"}),s("div",{class:"geo-shape geo-3"})],-1)),s("div",pe,[s("div",ve,[s("div",me,[s("div",ge,[s("div",_e,[o(g,{size:"28"},{default:l(()=>[o(r)]),_:1})]),e[7]||(e[7]=s("div",{class:"logo-text"},[s("h1",{class:"app-title"},[b(" Murk"),s("span",{style:{color:"#409EFF"}},"PHP"),b("加密 ")])],-1))])]),e[19]||(e[19]=s("div",{class:"form-header forgot-header"},[s("h2",null,"找回密码"),s("p",null,"重置您的账户密码")],-1)),s("div",we,[s("div",{class:v(["step",{active:a.value>=1,completed:a.value>1}])},e[8]||(e[8]=[s("div",{class:"step-number"},"1",-1),s("div",{class:"step-label"},"验证身份",-1)]),2),s("div",{class:v(["step-line",{active:a.value>1}])},null,2),s("div",{class:v(["step",{active:a.value>=2,completed:a.value>2}])},e[9]||(e[9]=[s("div",{class:"step-number"},"2",-1),s("div",{class:"step-label"},"验证码",-1)]),2),s("div",{class:v(["step-line",{active:a.value>2}])},null,2),s("div",{class:v(["step",{active:a.value>=3,completed:a.value>3}])},e[10]||(e[10]=[s("div",{class:"step-number"},"3",-1),s("div",{class:"step-label"},"重置密码",-1)]),2)]),s("div",ye,[a.value===1?(w(),_("div",be,[e[11]||(e[11]=s("div",{class:"form-header"},[s("h2",null,"验证您的身份"),s("p",null,"请输入您的用户名或邮箱地址")],-1)),o(q,{ref_key:"identityFormRef",ref:T,model:m,rules:O,class:"forgot-form",onSubmit:e[1]||(e[1]=L(()=>{},["prevent"]))},{default:l(()=>[o(c,{prop:"identifier"},{default:l(()=>[o(h,{modelValue:m.identifier,"onUpdate:modelValue":e[0]||(e[0]=P=>m.identifier=P),placeholder:"用户名或邮箱地址",size:"large",class:"form-input",onKeyup:M(B,["enter"])},{prefix:l(()=>[o(g,null,{default:l(()=>[o(K)]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(c,null,{default:l(()=>[o(F,{type:m.identifier?"primary":"info",size:"large",loading:d.value,disabled:!m.identifier,onClick:B,class:v(["submit-btn",{"btn-disabled":!m.identifier}])},{default:l(()=>[b(x(d.value?"验证中...":"下一步"),1)]),_:1},8,["type","loading","disabled","class"])]),_:1})]),_:1},8,["model"])])):I("",!0),a.value===2?(w(),_("div",he,[s("div",ke,[e[12]||(e[12]=s("h2",null,"输入验证码",-1)),s("p",null,"验证码已发送至 "+x(S.value),1)]),o(q,{ref_key:"codeFormRef",ref:$,model:C,rules:Q,class:"forgot-form",onSubmit:e[3]||(e[3]=L(()=>{},["prevent"]))},{default:l(()=>[o(c,{prop:"code"},{default:l(()=>[s("div",Ce,[(w(!0),_(re,null,ie(n.value,(P,V)=>ne((w(),_("input",{key:V,ref_for:!0,ref:f=>u.value[V]=f,"onUpdate:modelValue":f=>n.value[V]=f,type:"text",maxlength:"1",class:"code-digit-input",onInput:f=>H(V,f),onKeydown:f=>G(V,f),onPaste:e[2]||(e[2]=f=>J(f))},null,40,Pe)),[[de,n.value[V]]])),128))])]),_:1}),s("div",Ve,[o(F,{type:"text",disabled:k.value>0,onClick:Y,class:"resend-btn"},{default:l(()=>[b(x(k.value>0?`${k.value}秒后重发`:"重新发送"),1)]),_:1},8,["disabled"])])]),_:1},8,["model"])])):I("",!0),a.value===3?(w(),_("div",Fe,[e[14]||(e[14]=s("div",{class:"form-header"},[s("h2",null,"设置新密码"),s("p",null,"请设置一个安全的新密码")],-1)),o(q,{ref_key:"passwordFormRef",ref:E,model:i,rules:W,class:"forgot-form",onSubmit:e[6]||(e[6]=L(()=>{},["prevent"]))},{default:l(()=>[o(c,{prop:"password"},{default:l(()=>[o(h,{modelValue:i.password,"onUpdate:modelValue":e[4]||(e[4]=P=>i.password=P),type:"password",placeholder:"新密码",size:"large","show-password":"",class:"form-input",onKeyup:M(U,["enter"])},{prefix:l(()=>[o(g,null,{default:l(()=>[o(r)]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(c,{prop:"confirmPassword"},{default:l(()=>[o(h,{modelValue:i.confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=P=>i.confirmPassword=P),type:"password",placeholder:"确认新密码",size:"large","show-password":"",class:"form-input",onKeyup:M(U,["enter"])},{prefix:l(()=>[o(g,null,{default:l(()=>[o(r)]),_:1})]),_:1},8,["modelValue"])]),_:1}),s("div",Ie,[e[13]||(e[13]=s("div",{class:"strength-label"},"密码强度：",-1)),s("div",xe,[s("div",{class:v(["strength-fill",D.value.level]),style:ue({width:D.value.width})},null,6)]),s("div",{class:v(["strength-text",D.value.level])},x(D.value.text),3)]),o(c,null,{default:l(()=>[o(F,{type:i.password&&i.confirmPassword?"primary":"info",size:"large",loading:d.value,disabled:!i.password||!i.confirmPassword,onClick:U,class:v(["submit-btn",{"btn-disabled":!i.password||!i.confirmPassword}])},{default:l(()=>[b(x(d.value?"重置中...":"重置密码"),1)]),_:1},8,["type","loading","disabled","class"])]),_:1})]),_:1},8,["model"])])):I("",!0),a.value===4?(w(),_("div",ze,[s("div",Re,[o(g,{size:"64",color:"#67c23a"},{default:l(()=>[o(ee)]),_:1})]),e[16]||(e[16]=s("div",{class:"success-header"},[s("h2",null,"密码重置成功"),s("p",null,"您的密码已成功重置，请使用新密码登录")],-1)),o(F,{type:"primary",size:"large",onClick:j,class:"submit-btn"},{default:l(()=>e[15]||(e[15]=[b(" 返回登录 ",-1)])),_:1,__:[15]})])):I("",!0),a.value<4?(w(),_("div",De,[s("div",Te,[e[18]||(e[18]=b(" 记起密码了？ ",-1)),o(F,{type:"text",onClick:j,class:"login-btn"},{default:l(()=>e[17]||(e[17]=[b(" 返回登录 ",-1)])),_:1,__:[17]})])])):I("",!0)])])])])}}},qe=ce($e,[["__scopeId","data-v-ff8824ba"]]);export{qe as default};
