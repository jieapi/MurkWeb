import{_ as _e}from"./_plugin-vue_export-helper-c27b6911.js";import{r as m,a as J,l as fe,b as s,K as ve,o as G,c as ge,d as o,e as t,w as l,f as i,v as Ie,i as be,t as p,M as Te,E as x}from"./index-d670e9de.js";const ye={class:"token-management"},Ce={class:"card-header"},Ve={class:"token-value"},xe={class:"pagination-container"},we={class:"dialog-footer"},Me={class:"new-token-info"},he={class:"token-display"},Je={class:"dialog-footer"},Ue={class:"token-value"},ze={__name:"Tokens",setup(Oe){const w=m(!1),U=m(!1),g=m(!1),z=m("生成Token"),M=m(!1),O=m(!1),h=m(0),V=m(),A=m(""),c=J({id:null,token:"",name:"",callCount:0,lastUsedAt:"",status:"enabled",createdAt:"",remark:""}),T=J({token:"",status:""}),_=J({currentPage:1,pageSize:20}),d=J({id:null,name:"",status:"enabled",remark:""}),K={name:[{required:!0,message:"请输入Token名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}]},f=m([]),F=[{id:1,token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c",name:"管理后台Token",callCount:256,lastUsedAt:"2024-01-15 10:30:25",status:"enabled",createdAt:"2024-01-01 09:00:00",remark:"管理员使用的Token"},{id:2,token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkphbmUgRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.cThIIoDvwdueQB468K5xDc5633seEFoqwxjF_xSJyQQ",name:"接口管理Token",callCount:128,lastUsedAt:"2024-01-14 15:20:10",status:"enabled",createdAt:"2024-01-02 10:30:00",remark:"管理员使用的Token"},{id:3,token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkJvYiBTbWl0aCIsImlhdCI6MTUxNjIzOTAyMn0.8V6ckVz_V3ZJJHBpQaRlNWEhO5vLgX6L5E-7VB_L5Ks",name:"代理商Token",callCount:532,lastUsedAt:"2024-01-15 09:15:30",status:"enabled",createdAt:"2024-01-03 14:20:00",remark:"代理商使用的Token"},{id:4,token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkFsaWNlIEJyb3duIiwiaWF0IjoxNTE2MjM5MDIyfQ.MYj3fqOQJpg0YVHjCNLgJZ8J9QQK-Kov0TVnw-VIT_Y",name:"用户Token",callCount:78,lastUsedAt:"2024-01-14 16:45:30",status:"enabled",createdAt:"2024-01-04 16:45:00",remark:"普通用户使用的Token"},{id:5,token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkNoYXJsaWUgV2lsc29uIiwiaWF0IjoxNTE2MjM5MDIyfQ.RIrK8BMwQgDyUM3vO5uPVVGfBXbGIkbmIKCAnqOn_Fw",name:"测试Token",callCount:0,lastUsedAt:null,status:"disabled",createdAt:"2024-01-10 11:20:15",remark:"测试用的Token"}],y=()=>{w.value=!0,setTimeout(()=>{f.value=F,h.value=F.length,w.value=!1},500)},Y=()=>{_.currentPage=1,y()},X=()=>{Object.assign(T,{token:"",status:""}),_.currentPage=1,y()},L=()=>{y()},Z=()=>{z.value="生成Token",B(),g.value=!0},q=a=>{z.value="编辑Token",Object.assign(d,{id:a.id,name:a.name,status:a.status,remark:a.remark}),g.value=!0},H=a=>{Object.assign(c,a),O.value=!0},ee=async a=>{try{await Te.confirm(`确定要删除Token "${a.name}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=f.value.findIndex(u=>u.id===a.id);e>-1&&(f.value.splice(e,1),h.value--,x.success("删除成功"))}catch{}},te=a=>{const e=a.status==="enabled"?"启用":"禁用";x.success(`Token "${a.name}" 已${e}`)},le=async()=>{V.value&&await V.value.validate(a=>{a&&(U.value=!0,setTimeout(()=>{if(U.value=!1,d.id){const e=f.value.findIndex(u=>u.id===d.id);if(e>-1){const u={...f.value[e],name:d.name,status:d.status,remark:d.remark};f.value[e]=u,x.success("编辑成功")}g.value=!1}else{const e=ne();A.value=e;const u={id:Date.now(),token:e,name:d.name,callCount:0,lastUsedAt:null,status:d.status,createdAt:new Date().toLocaleString("zh-CN"),remark:d.remark};f.value.unshift(u),h.value++,g.value=!1,M.value=!0}},1e3))})},R=()=>{g.value=!1,B()},B=()=>{Object.assign(d,{id:null,name:"",status:"enabled",remark:""}),V.value&&V.value.resetFields()},Q=a=>a?a.substring(0,10)+"..."+a.substring(a.length-10):"",D=a=>{navigator.clipboard.writeText(a).then(()=>{x.success("Token已复制到剪贴板")}).catch(()=>{x.error("复制失败，请手动复制")})},ne=()=>{const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let u="";for(let k=0;k<32;k++)u+=a.charAt(Math.floor(Math.random()*a.length));return`mphp_${u}`},ae=a=>{_.pageSize=a,y()},oe=a=>{_.currentPage=a,y()};return fe(()=>{y()}),(a,e)=>{const u=s("el-input"),k=s("el-form-item"),j=s("el-option"),se=s("el-select"),ie=s("Search"),I=s("el-icon"),r=s("el-button"),E=s("Refresh"),de=s("Plus"),W=s("el-form"),P=s("el-card"),v=s("el-table-column"),ue=s("el-tooltip"),N=s("CopyDocument"),$=s("el-switch"),re=s("el-table"),ce=s("el-pagination"),S=s("el-dialog"),b=s("el-descriptions-item"),me=s("el-tag"),pe=s("el-descriptions"),ke=ve("loading");return G(),ge("div",ye,[e[27]||(e[27]=o("h1",{class:"page-title"},"Token管理",-1)),t(P,{class:"search-card"},{default:l(()=>[t(W,{model:T,inline:""},{default:l(()=>[t(k,{label:"Token"},{default:l(()=>[t(u,{modelValue:T.token,"onUpdate:modelValue":e[0]||(e[0]=n=>T.token=n),placeholder:"请输入Token",style:{width:"200px"},clearable:""},null,8,["modelValue"])]),_:1}),t(k,{label:"状态"},{default:l(()=>[t(se,{modelValue:T.status,"onUpdate:modelValue":e[1]||(e[1]=n=>T.status=n),placeholder:"全部状态",clearable:"",style:{width:"120px"}},{default:l(()=>[t(j,{label:"全部状态",value:""}),t(j,{label:"启用",value:"enabled"}),t(j,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),t(k,null,{default:l(()=>[t(r,{type:"primary",onClick:Y,loading:w.value},{default:l(()=>[t(I,null,{default:l(()=>[t(ie)]),_:1}),e[13]||(e[13]=i(" 搜索 ",-1))]),_:1,__:[13]},8,["loading"]),t(r,{onClick:X},{default:l(()=>[t(I,null,{default:l(()=>[t(E)]),_:1}),e[14]||(e[14]=i(" 重置 ",-1))]),_:1,__:[14]}),t(r,{type:"success",onClick:Z},{default:l(()=>[t(I,null,{default:l(()=>[t(de)]),_:1}),e[15]||(e[15]=i(" 生成Token ",-1))]),_:1,__:[15]})]),_:1})]),_:1},8,["model"])]),_:1}),t(P,null,{header:l(()=>[o("div",Ce,[e[17]||(e[17]=o("span",null,"Token列表",-1)),o("div",null,[t(r,{type:"primary",size:"small",onClick:L},{default:l(()=>[t(I,null,{default:l(()=>[t(E)]),_:1}),e[16]||(e[16]=i(" 刷新 ",-1))]),_:1,__:[16]})])])]),default:l(()=>[Ie((G(),be(re,{data:f.value,stripe:"",style:{width:"100%"}},{default:l(()=>[t(v,{prop:"id",label:"ID",width:"80"}),t(v,{prop:"token",label:"Token",width:"280"},{default:l(({row:n})=>[o("div",Ve,[t(ue,{content:n.token,placement:"top"},{default:l(()=>[o("span",null,p(Q(n.token)),1)]),_:2},1032,["content"]),t(r,{type:"text",onClick:C=>D(n.token)},{default:l(()=>[t(I,null,{default:l(()=>[t(N)]),_:1})]),_:2},1032,["onClick"])])]),_:1}),t(v,{prop:"name",label:"Token名称",width:"150"}),t(v,{prop:"callCount",label:"调用次数",width:"100"}),t(v,{prop:"lastUsedAt",label:"最后使用",width:"160"},{default:l(({row:n})=>[i(p(n.lastUsedAt||"未使用"),1)]),_:1}),t(v,{prop:"status",label:"状态",width:"100"},{default:l(({row:n})=>[t($,{modelValue:n.status,"onUpdate:modelValue":C=>n.status=C,"active-value":"enabled","inactive-value":"disabled",onChange:C=>te(n)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(v,{prop:"createdAt",label:"创建时间",width:"160"}),t(v,{label:"操作",width:"200",fixed:"right"},{default:l(({row:n})=>[t(r,{type:"text",size:"small",onClick:C=>q(n)},{default:l(()=>e[18]||(e[18]=[i(" 编辑 ",-1)])),_:2,__:[18]},1032,["onClick"]),t(r,{type:"text",size:"small",onClick:C=>H(n),style:{color:"#67c23a"}},{default:l(()=>e[19]||(e[19]=[i(" 查看 ",-1)])),_:2,__:[19]},1032,["onClick"]),t(r,{type:"text",size:"small",onClick:C=>ee(n),style:{color:"#f56c6c"}},{default:l(()=>e[20]||(e[20]=[i(" 删除 ",-1)])),_:2,__:[20]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ke,w.value]]),o("div",xe,[t(ce,{"current-page":_.currentPage,"onUpdate:currentPage":e[2]||(e[2]=n=>_.currentPage=n),"page-size":_.pageSize,"onUpdate:pageSize":e[3]||(e[3]=n=>_.pageSize=n),"page-sizes":[10,20,50,100],total:h.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ae,onCurrentChange:oe},null,8,["current-page","page-size","total"])])]),_:1}),t(S,{modelValue:g.value,"onUpdate:modelValue":e[7]||(e[7]=n=>g.value=n),title:z.value,width:"500px","before-close":R},{footer:l(()=>[o("span",we,[t(r,{onClick:R},{default:l(()=>e[21]||(e[21]=[i("取消",-1)])),_:1,__:[21]}),t(r,{type:"primary",onClick:le,loading:U.value},{default:l(()=>e[22]||(e[22]=[i(" 确定 ",-1)])),_:1,__:[22]},8,["loading"])])]),default:l(()=>[t(W,{ref_key:"tokenFormRef",ref:V,model:d,rules:K,"label-width":"100px"},{default:l(()=>[t(k,{label:"Token名称",prop:"name"},{default:l(()=>[t(u,{modelValue:d.name,"onUpdate:modelValue":e[4]||(e[4]=n=>d.name=n),placeholder:"请输入Token名称"},null,8,["modelValue"])]),_:1}),t(k,{label:"状态",prop:"status"},{default:l(()=>[t($,{modelValue:d.status,"onUpdate:modelValue":e[5]||(e[5]=n=>d.status=n),"active-value":"enabled","inactive-value":"disabled","active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),t(k,{label:"备注"},{default:l(()=>[t(u,{modelValue:d.remark,"onUpdate:modelValue":e[6]||(e[6]=n=>d.remark=n),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(S,{modelValue:M.value,"onUpdate:modelValue":e[10]||(e[10]=n=>M.value=n),title:"Token生成成功",width:"500px"},{footer:l(()=>[o("span",Je,[t(r,{type:"primary",onClick:e[9]||(e[9]=n=>M.value=!1)},{default:l(()=>e[26]||(e[26]=[i(" 我已保存 ",-1)])),_:1,__:[26]})])]),default:l(()=>[o("div",Me,[e[24]||(e[24]=o("p",{class:"warning-text"},"请保存好您的Token，它只会显示一次！",-1)),o("div",he,[o("span",null,p(A.value),1),t(r,{type:"primary",size:"small",onClick:e[8]||(e[8]=n=>D(A.value))},{default:l(()=>[t(I,null,{default:l(()=>[t(N)]),_:1}),e[23]||(e[23]=i(" 复制 ",-1))]),_:1,__:[23]})]),e[25]||(e[25]=o("div",{class:"token-tips"},[o("p",null,"使用说明："),o("ol",null,[o("li",null,[i("在API请求头中添加："),o("code",null,"Authorization: Bearer {token}")]),o("li",null,[i("或在请求参数中添加："),o("code",null,"token={token}")])])],-1))])]),_:1},8,["modelValue"]),t(S,{modelValue:O.value,"onUpdate:modelValue":e[12]||(e[12]=n=>O.value=n),title:"Token详情",width:"500px"},{default:l(()=>[t(pe,{column:1,border:""},{default:l(()=>[t(b,{label:"Token"},{default:l(()=>[o("div",Ue,[o("span",null,p(Q(c.token)),1),t(r,{type:"text",onClick:e[11]||(e[11]=n=>D(c.token))},{default:l(()=>[t(I,null,{default:l(()=>[t(N)]),_:1})]),_:1})])]),_:1}),t(b,{label:"Token名称"},{default:l(()=>[i(p(c.name),1)]),_:1}),t(b,{label:"调用次数"},{default:l(()=>[i(p(c.callCount),1)]),_:1}),t(b,{label:"最后使用"},{default:l(()=>[i(p(c.lastUsedAt||"未使用"),1)]),_:1}),t(b,{label:"状态"},{default:l(()=>[t(me,{type:c.status==="enabled"?"success":"danger"},{default:l(()=>[i(p(c.status==="enabled"?"启用":"禁用"),1)]),_:1},8,["type"])]),_:1}),t(b,{label:"创建时间"},{default:l(()=>[i(p(c.createdAt),1)]),_:1}),t(b,{label:"备注"},{default:l(()=>[i(p(c.remark||"-"),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},je=_e(ze,[["__scopeId","data-v-946cfbe8"]]);export{je as default};
