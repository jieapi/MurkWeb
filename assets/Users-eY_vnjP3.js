import{_ as ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as p,a as F,l as Se,c as Te,o as I,d as f,e,w as a,b as d,R as Ae,S as De,f as m,s as Re,i as H,t as b,n as Fe,T as J,E as w}from"./index-BEccWB-n.js";const Ie={class:"user-list"},Le={class:"card-header"},$e={class:"pagination-container"},Me={class:"user-info-display"},Pe={class:"balance-preview"},je={class:"dialog-footer"},Ee={class:"dialog-footer"},Oe={__name:"Users",setup(qe){const A=p(!1),L=p(!1),k=p(!1),V=p("add"),$=p("添加用户"),C=p([]),x=p(0),B=p(),U=p(!1),M=p(""),P=p(!1),z=p(),v=F({username:"",email:"",status:"",role:""}),y=F({currentPage:1,pageSize:20}),r=F({id:null,username:"",email:"",role:"user",status:"active",password:"",balance:0,remark:""}),n=F({userId:null,username:"",currentBalance:0,type:"recharge",amount:null,reason:""}),ee={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]},le={amount:[{required:!0,message:"请输入金额",trigger:"blur"},{type:"number",min:.01,message:"金额必须大于0.01",trigger:"blur"},{validator:(s,l,i)=>{n.type==="deduct"&&l>n.currentBalance?i(new Error("扣款金额不能超过用户当前余额")):i()},trigger:"blur"}],reason:[{max:200,message:"长度不能超过200个字符",trigger:"blur"}]},g=p([]),K=[{id:1,username:"superadmin",email:"superadmin@example.com",role:"super_admin",status:"active",balance:1e4,lastLoginAt:"2024-01-15 10:30:25",createdAt:"2024-01-01 09:00:00",remark:"超级管理员"},{id:2,username:"admin",email:"admin@example.com",role:"admin",status:"active",balance:5e3,lastLoginAt:"2024-01-15 09:15:10",createdAt:"2024-01-02 10:30:00",remark:"管理员"},{id:3,username:"agent001",email:"agent001@example.com",role:"agent",status:"active",balance:3e3,lastLoginAt:"2024-01-14 16:45:30",createdAt:"2024-01-03 14:20:00",remark:"代理商"},{id:4,username:"user001",email:"user001@example.com",role:"user",status:"active",balance:1e3,lastLoginAt:"2024-01-15 11:20:15",createdAt:"2024-01-04 16:45:00",remark:"普通用户"},{id:5,username:"user002",email:"user002@example.com",role:"user",status:"disabled",balance:500,lastLoginAt:"2024-01-10 11:20:15",createdAt:"2024-01-05 16:45:00",remark:"已禁用用户"},{id:6,username:"user003",email:"user003@example.com",role:"user",status:"pending",balance:0,lastLoginAt:null,createdAt:"2024-01-15 08:30:00",remark:"待审核用户"}],h=()=>{A.value=!0,setTimeout(()=>{g.value=K,x.value=K.length,A.value=!1},500)},ae=()=>{y.currentPage=1,h()},te=()=>{Object.assign(v,{username:"",email:"",status:"",role:""}),y.currentPage=1,h()},ne=()=>{h()},se=()=>{V.value="add",$.value="添加用户",Q(),k.value=!0},oe=s=>{V.value="edit",$.value="编辑用户",Object.assign(r,s),k.value=!0},re=s=>{n.userId=s.id,n.username=s.username,n.currentBalance=s.balance,n.type="recharge",n.amount=null,n.reason="",M.value="用户充值",U.value=!0},ue=s=>{n.userId=s.id,n.username=s.username,n.currentBalance=s.balance,n.type="deduct",n.amount=null,n.reason="",M.value="用户扣款",U.value=!0},de=async()=>{z.value&&await z.value.validate(async s=>{if(s){const l=n.type==="recharge"?"充值":"扣款",i=E();if(n.type==="deduct"&&i<0){w.error("余额不足，无法扣款");return}try{await J.confirm(`确认为用户 "${n.username}" ${l} ¥${n.amount} 吗？
操作后余额将变为: ¥${i}`,`确认${l}`,{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),P.value=!0,await new Promise(u=>setTimeout(u,1e3));const o=g.value.findIndex(u=>u.id===n.userId);o>-1&&(g.value[o].balance=parseFloat(i.toFixed(2))),w.success(`${l}成功`),j()}catch(o){o!=="cancel"&&w.error(`${l}失败，请重试`)}finally{P.value=!1}}})},j=()=>{U.value=!1,ie()},ie=()=>{Object.assign(n,{userId:null,username:"",currentBalance:0,type:"recharge",amount:null,reason:""}),z.value&&z.value.resetFields()},E=()=>n.amount?n.type==="recharge"?n.currentBalance+n.amount:n.currentBalance-n.amount:n.currentBalance,me=()=>E()<0?"balance-negative":n.type==="recharge"&&n.amount>0?"balance-positive":"balance-normal",ce=async s=>{try{await J.confirm(`确定要删除用户 "${s.username}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const l=g.value.findIndex(i=>i.id===s.id);l>-1&&(g.value.splice(l,1),x.value--,w.success("删除成功"))}catch{}},pe=async()=>{try{await J.confirm(`确定要删除选中的 ${C.value.length} 个用户吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const s=C.value.map(l=>l.id);g.value=g.value.filter(l=>!s.includes(l.id)),x.value=g.value.length,C.value=[],w.success("批量删除成功")}catch{}},ge=s=>{C.value=s},fe=async()=>{B.value&&await B.value.validate(s=>{s&&(L.value=!0,setTimeout(()=>{if(L.value=!1,V.value==="add"){const l={...r,id:Date.now(),lastLoginAt:null,createdAt:new Date().toLocaleString("zh-CN")};g.value.unshift(l),x.value++,w.success("添加成功")}else{const l=g.value.findIndex(i=>i.id===r.id);l>-1&&(Object.assign(g.value[l],r),w.success("编辑成功"))}O()},1e3))})},O=()=>{k.value=!1,Q()},Q=()=>{Object.assign(r,{id:null,username:"",email:"",role:"user",status:"active",password:"",balance:0,remark:""}),B.value&&B.value.resetFields()},ve=s=>{y.pageSize=s,h()},_e=s=>{y.currentPage=s,h()},be=s=>({super_admin:"danger",admin:"warning",agent:"success",user:"info"})[s]||"info",ye=s=>({super_admin:"超级管理员",admin:"管理员",agent:"代理商",user:"普通用户"})[s]||s,we=s=>({active:"success",disabled:"danger",pending:"warning"})[s]||"info",Ve=s=>({active:"正常",disabled:"禁用",pending:"待审核"})[s]||s;return Se(()=>{h()}),(s,l)=>{const i=d("el-input"),o=d("el-form-item"),u=d("el-option"),D=d("el-select"),xe=d("Search"),S=d("el-icon"),c=d("el-button"),W=d("Refresh"),he=d("Plus"),q=d("el-form"),X=d("el-card"),ke=d("Delete"),_=d("el-table-column"),R=d("el-tag"),Ce=d("el-table"),Be=d("el-pagination"),Y=d("el-input-number"),Z=d("el-dialog"),T=d("el-col"),N=d("el-row"),Ue=De("loading");return I(),Te("div",Ie,[l[30]||(l[30]=f("h1",{class:"page-title"},"用户列表",-1)),e(X,{class:"search-card"},{default:a(()=>[e(q,{model:v,inline:""},{default:a(()=>[e(o,{label:"用户名"},{default:a(()=>[e(i,{modelValue:v.username,"onUpdate:modelValue":l[0]||(l[0]=t=>v.username=t),placeholder:"请输入用户名",style:{width:"200px"},clearable:""},null,8,["modelValue"])]),_:1}),e(o,{label:"邮箱"},{default:a(()=>[e(i,{modelValue:v.email,"onUpdate:modelValue":l[1]||(l[1]=t=>v.email=t),placeholder:"请输入邮箱",style:{width:"200px"},clearable:""},null,8,["modelValue"])]),_:1}),e(o,{label:"状态"},{default:a(()=>[e(D,{modelValue:v.status,"onUpdate:modelValue":l[2]||(l[2]=t=>v.status=t),placeholder:"全部状态",clearable:"",style:{width:"120px"}},{default:a(()=>[e(u,{label:"全部状态",value:""}),e(u,{label:"正常",value:"active"}),e(u,{label:"禁用",value:"disabled"}),e(u,{label:"待审核",value:"pending"})]),_:1},8,["modelValue"])]),_:1}),e(o,{label:"角色"},{default:a(()=>[e(D,{modelValue:v.role,"onUpdate:modelValue":l[3]||(l[3]=t=>v.role=t),placeholder:"全部角色",clearable:"",style:{width:"140px"}},{default:a(()=>[e(u,{label:"全部角色",value:""}),e(u,{label:"超级管理员",value:"super_admin"}),e(u,{label:"管理员",value:"admin"}),e(u,{label:"代理商",value:"agent"}),e(u,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1}),e(o,null,{default:a(()=>[e(c,{type:"primary",onClick:ae,loading:A.value},{default:a(()=>[e(S,null,{default:a(()=>[e(xe)]),_:1}),l[17]||(l[17]=m(" 搜索 ",-1))]),_:1,__:[17]},8,["loading"]),e(c,{onClick:te},{default:a(()=>[e(S,null,{default:a(()=>[e(W)]),_:1}),l[18]||(l[18]=m(" 重置 ",-1))]),_:1,__:[18]}),e(c,{type:"success",onClick:se},{default:a(()=>[e(S,null,{default:a(()=>[e(he)]),_:1}),l[19]||(l[19]=m(" 添加用户 ",-1))]),_:1,__:[19]})]),_:1})]),_:1},8,["model"])]),_:1}),e(X,null,{header:a(()=>[f("div",Le,[f("span",null,"用户列表 (共 "+b(x.value)+" 个用户)",1),f("div",null,[e(c,{type:"danger",size:"small",disabled:C.value.length===0,onClick:pe},{default:a(()=>[e(S,null,{default:a(()=>[e(ke)]),_:1}),l[20]||(l[20]=m(" 批量删除 ",-1))]),_:1,__:[20]},8,["disabled"]),e(c,{type:"primary",size:"small",onClick:ne},{default:a(()=>[e(S,null,{default:a(()=>[e(W)]),_:1}),l[21]||(l[21]=m(" 刷新 ",-1))]),_:1,__:[21]})])])]),default:a(()=>[Re((I(),H(Ce,{data:g.value,stripe:"",style:{width:"100%"},onSelectionChange:ge},{default:a(()=>[e(_,{type:"selection",width:"55"}),e(_,{prop:"id",label:"ID",width:"80"}),e(_,{prop:"username",label:"用户名",width:"120"}),e(_,{prop:"email",label:"邮箱",width:"200"}),e(_,{prop:"role",label:"角色",width:"120"},{default:a(({row:t})=>[e(R,{type:be(t.role)},{default:a(()=>[m(b(ye(t.role)),1)]),_:2},1032,["type"])]),_:1}),e(_,{prop:"status",label:"状态",width:"100"},{default:a(({row:t})=>[e(R,{type:we(t.status)},{default:a(()=>[m(b(Ve(t.status)),1)]),_:2},1032,["type"])]),_:1}),e(_,{prop:"balance",label:"余额",width:"120"},{default:a(({row:t})=>[m(b(t.balance)+" 元 ",1)]),_:1}),e(_,{prop:"lastLoginAt",label:"最后登录",width:"160"}),e(_,{prop:"createdAt",label:"注册时间",width:"160"}),e(_,{label:"操作",width:"260",fixed:"right"},{default:a(({row:t})=>[e(c,{type:"text",size:"small",onClick:G=>oe(t)},{default:a(()=>l[22]||(l[22]=[m(" 编辑 ",-1)])),_:2,__:[22]},1032,["onClick"]),e(c,{type:"text",size:"small",onClick:G=>re(t),style:{color:"#67c23a"}},{default:a(()=>l[23]||(l[23]=[m(" 充值 ",-1)])),_:2,__:[23]},1032,["onClick"]),e(c,{type:"text",size:"small",onClick:G=>ue(t),style:{color:"#e6a23c"}},{default:a(()=>l[24]||(l[24]=[m(" 扣款 ",-1)])),_:2,__:[24]},1032,["onClick"]),e(c,{type:"text",size:"small",onClick:G=>ce(t),style:{color:"#f56c6c"}},{default:a(()=>l[25]||(l[25]=[m(" 删除 ",-1)])),_:2,__:[25]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ue,A.value]]),f("div",$e,[e(Be,{"current-page":y.currentPage,"onUpdate:currentPage":l[4]||(l[4]=t=>y.currentPage=t),"page-size":y.pageSize,"onUpdate:pageSize":l[5]||(l[5]=t=>y.pageSize=t),"page-sizes":[10,20,50,100],total:x.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ve,onCurrentChange:_e},null,8,["current-page","page-size","total"])])]),_:1}),e(Z,{modelValue:U.value,"onUpdate:modelValue":l[8]||(l[8]=t=>U.value=t),title:M.value,width:"500px","before-close":j},{footer:a(()=>[f("span",je,[e(c,{onClick:j},{default:a(()=>l[27]||(l[27]=[m("取消",-1)])),_:1,__:[27]}),e(c,{type:n.type==="recharge"?"success":"warning",onClick:de,loading:P.value},{default:a(()=>[m(" 确认"+b(n.type==="recharge"?"充值":"扣款"),1)]),_:1},8,["type","loading"])])]),default:a(()=>[e(q,{ref_key:"balanceFormRef",ref:z,model:n,rules:le,"label-width":"100px"},{default:a(()=>[e(o,{label:"用户信息"},{default:a(()=>[f("div",Me,[f("span",null,b(n.username)+" (ID: "+b(n.userId)+")",1),e(R,{type:"info",size:"small",style:{"margin-left":"10px"}},{default:a(()=>[m(" 当前余额: ¥"+b(n.currentBalance),1)]),_:1})])]),_:1}),e(o,{label:"操作类型"},{default:a(()=>[e(R,{type:n.type==="recharge"?"success":"warning",size:"large"},{default:a(()=>[m(b(n.type==="recharge"?"充值":"扣款"),1)]),_:1},8,["type"])]),_:1}),e(o,{label:"金额",prop:"amount"},{default:a(()=>[e(Y,{modelValue:n.amount,"onUpdate:modelValue":l[6]||(l[6]=t=>n.amount=t),min:.01,max:99999.99,precision:2,placeholder:"请输入金额",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(o,{label:"操作原因"},{default:a(()=>[e(i,{modelValue:n.reason,"onUpdate:modelValue":l[7]||(l[7]=t=>n.reason=t),type:"textarea",rows:3,placeholder:"请输入操作原因（可选）",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(o,{label:"预计余额"},{default:a(()=>[f("div",Pe,[l[26]||(l[26]=f("span",null,"操作后余额: ",-1)),f("span",{class:Fe(me())}," ¥"+b(E()),3)])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(Z,{modelValue:k.value,"onUpdate:modelValue":l[16]||(l[16]=t=>k.value=t),title:$.value,width:"50%","before-close":O},Ae({default:a(()=>[e(q,{ref_key:"userFormRef",ref:B,model:r,rules:ee,"label-width":"100px",disabled:V.value==="view"},{default:a(()=>[e(N,{gutter:20},{default:a(()=>[e(T,{span:12},{default:a(()=>[e(o,{label:"用户名",prop:"username"},{default:a(()=>[e(i,{modelValue:r.username,"onUpdate:modelValue":l[9]||(l[9]=t=>r.username=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1})]),_:1}),e(T,{span:12},{default:a(()=>[e(o,{label:"邮箱",prop:"email"},{default:a(()=>[e(i,{modelValue:r.email,"onUpdate:modelValue":l[10]||(l[10]=t=>r.email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(N,{gutter:20},{default:a(()=>[e(T,{span:12},{default:a(()=>[e(o,{label:"角色",prop:"role"},{default:a(()=>[e(D,{modelValue:r.role,"onUpdate:modelValue":l[11]||(l[11]=t=>r.role=t),placeholder:"全部角色",style:{width:"100%"}},{default:a(()=>[e(u,{label:"超级管理员",value:"super_admin"}),e(u,{label:"管理员",value:"admin"}),e(u,{label:"代理商",value:"agent"}),e(u,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(T,{span:12},{default:a(()=>[e(o,{label:"状态",prop:"status"},{default:a(()=>[e(D,{modelValue:r.status,"onUpdate:modelValue":l[12]||(l[12]=t=>r.status=t),placeholder:"全部状态",style:{width:"100%"}},{default:a(()=>[e(u,{label:"正常",value:"active"}),e(u,{label:"禁用",value:"disabled"}),e(u,{label:"待审核",value:"pending"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(N,{gutter:20},{default:a(()=>[e(T,{span:12},{default:a(()=>[V.value==="add"?(I(),H(o,{key:0,label:"密码",prop:"password"},{default:a(()=>[e(i,{modelValue:r.password,"onUpdate:modelValue":l[13]||(l[13]=t=>r.password=t),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})):(I(),H(o,{key:1,label:"余额",prop:"balance"},{default:a(()=>[e(Y,{modelValue:r.balance,"onUpdate:modelValue":l[14]||(l[14]=t=>r.balance=t),min:0,precision:2,step:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1}))]),_:1})]),_:1}),e(o,{label:"备注"},{default:a(()=>[e(i,{modelValue:r.remark,"onUpdate:modelValue":l[15]||(l[15]=t=>r.remark=t),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","disabled"])]),_:2},[V.value!=="view"?{name:"footer",fn:a(()=>[f("span",Ee,[e(c,{onClick:O},{default:a(()=>l[28]||(l[28]=[m("取消",-1)])),_:1,__:[28]}),e(c,{type:"primary",onClick:fe,loading:L.value},{default:a(()=>l[29]||(l[29]=[m(" 确定 ",-1)])),_:1,__:[29]},8,["loading"])])]),key:"0"}:void 0]),1032,["modelValue","title"])])}}},He=ze(Oe,[["__scopeId","data-v-7a2ad39d"]]);export{He as default};
