import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as b,a as R,l as me,c as ie,o as k,d as _,e,w as l,b as d,S as ce,f as o,s as fe,i as w,t as u,p as D,E as H}from"./index-BEccWB-n.js";const _e={class:"order-management"},ge={class:"card-header"},ye={class:"pagination-container"},be={class:"dialog-footer"},ve={class:"dialog-footer"},ke={__name:"Orders",setup(Ve){const C=b(!1),O=b(!1),V=b(!1),A=b(!1),U=b(0),z=b(),r=R({orderNo:"",username:"",orderType:"",productName:"",amount:0,status:"",refundAmount:0,createdAt:"",completedAt:"",remark:""}),s=R({orderNo:"",username:"",orderType:"",status:"",dateRange:[]}),g=R({currentPage:1,pageSize:20}),m=R({amount:0,remark:""}),I={amount:[{required:!0,message:"请输入退款金额",trigger:"blur"},{type:"number",min:.01,message:"金额必须大于0",trigger:"blur"}]},S=b([]),P=[{orderNo:"ORD202401150001",username:"user001",orderType:"product",productName:"murkphp加密服务-标准版",amount:299,status:"completed",refundAmount:50,createdAt:"2024-01-15 10:30:25",completedAt:"2024-01-15 10:31:05",remark:"部分退款50元"},{orderNo:"ORD202401150002",username:"user002",orderType:"encrypt",productName:"PHP文件加密服务",amount:199,status:"prepaid",refundAmount:0,createdAt:"2024-01-15 11:20:15",completedAt:null,remark:"预付费订单"},{orderNo:"ORD202401150003",username:"agent001",orderType:"encrypt",productName:"JavaScript加密服务",amount:500,status:"completed",refundAmount:100,createdAt:"2024-01-15 14:15:30",completedAt:"2024-01-15 14:16:05",remark:"服务问题退款100元"},{orderNo:"ORD202401140001",username:"user003",orderType:"product",productName:"murkphp加密服务-基础版",amount:199,status:"prepaid",refundAmount:0,createdAt:"2024-01-14 16:45:30",completedAt:null,remark:"预付费订单"},{orderNo:"ORD202401140002",username:"user001",orderType:"product",productName:"murkphp加密服务-高级版",amount:599,status:"refunded",refundAmount:599,createdAt:"2024-01-14 09:15:10",completedAt:"2024-01-14 09:16:00",remark:"客户要求全额退款"},{orderNo:"ORD202401130001",username:"user004",orderType:"encrypt",productName:"批量文件加密服务",amount:999,status:"completed",refundAmount:200,createdAt:"2024-01-13 13:20:45",completedAt:"2024-01-13 14:30:00",remark:"批量加密服务已完成，部分退款200元"}],v=()=>{C.value=!0,setTimeout(()=>{S.value=P,U.value=P.length,C.value=!1},500)},J=()=>{g.currentPage=1,v()},G=()=>{Object.assign(s,{orderNo:"",username:"",orderType:"",status:"",dateRange:[]}),g.currentPage=1,v()},K=()=>{v()},Q=()=>{H.success("订单数据导出成功")},W=n=>{Object.assign(r,n),V.value=!0},T=n=>{Object.assign(r,n),m.amount=n.amount,m.remark="",A.value=!0,V.value=!1},X=async()=>{z.value&&await z.value.validate(n=>{n&&(O.value=!0,setTimeout(()=>{O.value=!1;const t=S.value.find(N=>N.orderNo===r.orderNo);t&&(t.status="refunded",t.refundAmount=m.amount,t.remark=m.remark||"管理员退款"),H.success(`订单 ${r.orderNo} 已退款 ${m.amount} 元`),A.value=!1},1e3))})},Z=n=>{g.pageSize=n,v()},ee=n=>{g.currentPage=n,v()},te=n=>({product:"primary",encrypt:"success"})[n]||"",$=n=>({product:"购买产品",encrypt:"加密服务"})[n]||n,h=n=>({prepaid:"warning",refunded:"danger",completed:"success"})[n]||"",j=n=>({prepaid:"预付费",refunded:"已退款",completed:"已完成"})[n]||n;return me(()=>{v()}),(n,t)=>{const N=d("el-input"),i=d("el-form-item"),y=d("el-option"),B=d("el-select"),le=d("el-date-picker"),ae=d("Search"),x=d("el-icon"),p=d("el-button"),F=d("Refresh"),L=d("el-form"),Y=d("el-card"),oe=d("Download"),c=d("el-table-column"),M=d("el-tag"),re=d("el-table"),ne=d("el-pagination"),f=d("el-descriptions-item"),de=d("el-descriptions"),E=d("el-dialog"),ue=d("el-input-number"),se=ce("loading");return k(),ie("div",_e,[t[28]||(t[28]=_("h1",{class:"page-title"},"订单管理",-1)),e(Y,{class:"search-card"},{default:l(()=>[e(L,{model:s,inline:""},{default:l(()=>[e(i,{label:"订单号"},{default:l(()=>[e(N,{modelValue:s.orderNo,"onUpdate:modelValue":t[0]||(t[0]=a=>s.orderNo=a),placeholder:"请输入订单号",style:{width:"200px"},clearable:""},null,8,["modelValue"])]),_:1}),e(i,{label:"用户名"},{default:l(()=>[e(N,{modelValue:s.username,"onUpdate:modelValue":t[1]||(t[1]=a=>s.username=a),placeholder:"请输入用户名",style:{width:"200px"},clearable:""},null,8,["modelValue"])]),_:1}),e(i,{label:"订单类型"},{default:l(()=>[e(B,{modelValue:s.orderType,"onUpdate:modelValue":t[2]||(t[2]=a=>s.orderType=a),placeholder:"全部订单类型",clearable:"",style:{width:"140px"}},{default:l(()=>[e(y,{label:"全部订单类型",value:""}),e(y,{label:"购买产品",value:"product"}),e(y,{label:"加密服务",value:"encrypt"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"订单状态"},{default:l(()=>[e(B,{modelValue:s.status,"onUpdate:modelValue":t[3]||(t[3]=a=>s.status=a),placeholder:"全部状态",clearable:"",style:{width:"120px"}},{default:l(()=>[e(y,{label:"全部状态",value:""}),e(y,{label:"预付费",value:"prepaid"}),e(y,{label:"已退款",value:"refunded"}),e(y,{label:"已完成",value:"completed"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"下单时间"},{default:l(()=>[e(le,{modelValue:s.dateRange,"onUpdate:modelValue":t[4]||(t[4]=a=>s.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(i,null,{default:l(()=>[e(p,{type:"primary",onClick:J,loading:C.value},{default:l(()=>[e(x,null,{default:l(()=>[e(ae)]),_:1}),t[15]||(t[15]=o(" 搜索 ",-1))]),_:1,__:[15]},8,["loading"]),e(p,{onClick:G},{default:l(()=>[e(x,null,{default:l(()=>[e(F)]),_:1}),t[16]||(t[16]=o(" 重置 ",-1))]),_:1,__:[16]})]),_:1})]),_:1},8,["model"])]),_:1}),e(Y,null,{header:l(()=>[_("div",ge,[t[19]||(t[19]=_("span",null,"订单列表",-1)),_("div",null,[e(p,{type:"primary",size:"small",onClick:K},{default:l(()=>[e(x,null,{default:l(()=>[e(F)]),_:1}),t[17]||(t[17]=o(" 刷新 ",-1))]),_:1,__:[17]}),e(p,{type:"success",size:"small",onClick:Q},{default:l(()=>[e(x,null,{default:l(()=>[e(oe)]),_:1}),t[18]||(t[18]=o(" 导出数据 ",-1))]),_:1,__:[18]})])])]),default:l(()=>[fe((k(),w(re,{data:S.value,stripe:"",style:{width:"100%"}},{default:l(()=>[e(c,{prop:"orderNo",label:"订单号",width:"180"}),e(c,{prop:"username",label:"用户名",width:"120"}),e(c,{prop:"productName",label:"订单备注",width:"200"}),e(c,{prop:"orderType",label:"订单类型",width:"120"},{default:l(({row:a})=>[e(M,{type:te(a.orderType)},{default:l(()=>[o(u($(a.orderType)),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"amount",label:"订单金额",width:"120"},{default:l(({row:a})=>[o(u(a.amount)+" 元 ",1)]),_:1}),e(c,{prop:"refundAmount",label:"已退金额",width:"120"},{default:l(({row:a})=>[o(u(a.refundAmount||0)+" 元 ",1)]),_:1}),e(c,{prop:"status",label:"订单状态",width:"100"},{default:l(({row:a})=>[e(M,{type:h(a.status)},{default:l(()=>[o(u(j(a.status)),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"createdAt",label:"创建时间",width:"160"}),e(c,{prop:"completedAt",label:"完成时间",width:"160"},{default:l(({row:a})=>[o(u(a.completedAt||"-"),1)]),_:1}),e(c,{label:"操作",width:"200",fixed:"right"},{default:l(({row:a})=>[e(p,{type:"text",size:"small",onClick:q=>W(a),style:{color:"#67c23a"}},{default:l(()=>t[20]||(t[20]=[o(" 查看 ",-1)])),_:2,__:[20]},1032,["onClick"]),a.status==="completed"?(k(),w(p,{key:0,type:"text",size:"small",onClick:q=>T(a),style:{color:"#e6a23c"}},{default:l(()=>t[21]||(t[21]=[o(" 退款 ",-1)])),_:2,__:[21]},1032,["onClick"])):D("",!0),a.status==="prepaid"?(k(),w(p,{key:1,type:"text",size:"small",onClick:q=>T(a),style:{color:"#e6a23c"}},{default:l(()=>t[22]||(t[22]=[o(" 退款 ",-1)])),_:2,__:[22]},1032,["onClick"])):D("",!0)]),_:1})]),_:1},8,["data"])),[[se,C.value]]),_("div",ye,[e(ne,{"current-page":g.currentPage,"onUpdate:currentPage":t[5]||(t[5]=a=>g.currentPage=a),"page-size":g.pageSize,"onUpdate:pageSize":t[6]||(t[6]=a=>g.pageSize=a),"page-sizes":[10,20,50,100],total:U.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Z,onCurrentChange:ee},null,8,["current-page","page-size","total"])])]),_:1}),e(E,{modelValue:V.value,"onUpdate:modelValue":t[10]||(t[10]=a=>V.value=a),title:"订单详情",width:"600px"},{footer:l(()=>[_("span",be,[e(p,{onClick:t[7]||(t[7]=a=>V.value=!1)},{default:l(()=>t[23]||(t[23]=[o("关闭",-1)])),_:1,__:[23]}),r.status==="completed"?(k(),w(p,{key:0,type:"warning",onClick:t[8]||(t[8]=a=>T(r))},{default:l(()=>t[24]||(t[24]=[o(" 退款 ",-1)])),_:1,__:[24]})):D("",!0),r.status==="prepaid"?(k(),w(p,{key:1,type:"warning",onClick:t[9]||(t[9]=a=>T(r))},{default:l(()=>t[25]||(t[25]=[o(" 退款 ",-1)])),_:1,__:[25]})):D("",!0)])]),default:l(()=>[e(de,{column:1,border:""},{default:l(()=>[e(f,{label:"订单号"},{default:l(()=>[o(u(r.orderNo),1)]),_:1}),e(f,{label:"用户名"},{default:l(()=>[o(u(r.username),1)]),_:1}),e(f,{label:"订单类型"},{default:l(()=>[o(u($(r.orderType)),1)]),_:1}),e(f,{label:"订单金额"},{default:l(()=>[o(u(r.amount)+" 元",1)]),_:1}),e(f,{label:"已退金额"},{default:l(()=>[o(u(r.refundAmount||0)+" 元",1)]),_:1}),e(f,{label:"订单状态"},{default:l(()=>[e(M,{type:h(r.status)},{default:l(()=>[o(u(j(r.status)),1)]),_:1},8,["type"])]),_:1}),e(f,{label:"创建时间"},{default:l(()=>[o(u(r.createdAt),1)]),_:1}),e(f,{label:"完成时间"},{default:l(()=>[o(u(r.completedAt||"-"),1)]),_:1}),e(f,{label:"订单备注"},{default:l(()=>[o(u(r.productName),1)]),_:1}),e(f,{label:"备注"},{default:l(()=>[o(u(r.remark||"-"),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(E,{modelValue:A.value,"onUpdate:modelValue":t[14]||(t[14]=a=>A.value=a),title:"申请退款",width:"400px"},{footer:l(()=>[_("span",ve,[e(p,{onClick:t[13]||(t[13]=a=>A.value=!1)},{default:l(()=>t[26]||(t[26]=[o("取消",-1)])),_:1,__:[26]}),e(p,{type:"warning",onClick:X,loading:O.value},{default:l(()=>t[27]||(t[27]=[o(" 确认退款 ",-1)])),_:1,__:[27]},8,["loading"])])]),default:l(()=>[e(L,{ref_key:"refundFormRef",ref:z,model:m,rules:I,"label-width":"100px"},{default:l(()=>[e(i,{label:"订单号"},{default:l(()=>[_("span",null,u(r.orderNo),1)]),_:1}),e(i,{label:"订单金额"},{default:l(()=>[_("span",null,u(r.amount)+" 元",1)]),_:1}),e(i,{label:"退款金额",prop:"amount"},{default:l(()=>[e(ue,{modelValue:m.amount,"onUpdate:modelValue":t[11]||(t[11]=a=>m.amount=a),min:.01,max:r.amount,precision:2,step:1,style:{width:"100%"}},null,8,["modelValue","max"])]),_:1}),e(i,{label:"备注"},{default:l(()=>[e(N,{modelValue:m.remark,"onUpdate:modelValue":t[12]||(t[12]=a=>m.remark=a),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},we=pe(ke,[["__scopeId","data-v-28d82385"]]);export{we as default};
