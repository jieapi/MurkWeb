import{r as v,a as A,j as se,k as te,l as oe,m as le,b as w,o as y,c as b,d as s,e as o,w as l,f as h,n as m,g as L,t as I,p as M,q as z,F as ae,h as re,s as ie,u as ne,E as R,v as de,x as ue}from"./index-8c5ed3cb.js";import{_ as ce}from"./_plugin-vue_export-helper-c27b6911.js";const fe={class:"forgot-password-container"},pe={class:"main-content"},ve={class:"forgot-box"},me={class:"logo-section"},ge={class:"logo-wrapper"},_e={class:"logo-icon"},we={class:"steps-indicator"},ye={class:"form-section"},be={key:0,class:"step-content"},he={key:1,class:"step-content"},ke={class:"form-header"},Ce={class:"code-input-container"},Pe=["onUpdate:modelValue","onInput","onKeydown"],Ve={class:"code-actions"},Fe={key:2,class:"step-content"},xe={class:"password-strength"},Ie={class:"strength-bar"},ze={key:3,class:"step-content success-content"},Re={class:"success-icon"},De={key:4,class:"form-footer"},Te={class:"back-link"},$e={__name:"ForgotPassword",setup(Ee){const Z=ne(),$=v(),E=v(),S=v(),u=v(!1),r=v(1),k=v(0),U=v(""),d=v(["","","","","",""]),f=v([]);let D=null;const H=(t,e)=>{var i;const a=e.target.value;if(!/^\d*$/.test(a)){d.value[t]="";return}d.value[t]=a,a&&t<5&&((i=f.value[t+1])==null||i.focus()),C.code=d.value.join(""),C.code.length===6&&X()},G=(t,e)=>{var a,i,P;e.key==="Backspace"&&!d.value[t]&&t>0&&((a=f.value[t-1])==null||a.focus()),e.key==="ArrowLeft"&&t>0&&((i=f.value[t-1])==null||i.focus()),e.key==="ArrowRight"&&t<5&&((P=f.value[t+1])==null||P.focus())},J=t=>{var V;t.preventDefault(),t.clipboardData.getData("text").replace(/\D/g,"").slice(0,6).split("").forEach((c,_)=>{_<6&&(d.value[_]=c)});const i=d.value.findIndex(c=>!c),P=i===-1?5:i;(V=f.value[P])==null||V.focus(),C.code=d.value.join("")},g=A({identifier:""}),O={identifier:[{required:!0,message:"请输入用户名或邮箱地址",trigger:"blur"},{min:3,message:"至少输入3个字符",trigger:"blur"}]},C=A({code:""}),Q={code:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:6,message:"验证码为6位数字",trigger:"blur"},{pattern:/^\d{6}$/,message:"验证码只能是数字",trigger:"blur"}]},n=A({password:"",confirmPassword:""}),W={password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d@$!%*?&]{6,}$/,message:"密码必须包含大小写字母和数字",trigger:"blur"}],confirmPassword:[{validator:(t,e,a)=>{e===""?a(new Error("请再次输入密码")):e!==n.password?a(new Error("两次输入密码不一致")):a()},trigger:"blur"}]},T=se(()=>{const t=n.password;if(!t)return{level:"weak",width:"0%",text:""};let e=0;return t.length>=8&&(e+=1),t.length>=12&&(e+=1),/[a-z]/.test(t)&&(e+=1),/[A-Z]/.test(t)&&(e+=1),/\d/.test(t)&&(e+=1),/[!@#$%^&*(),.?":{}|<>]/.test(t)&&(e+=1),e<=2?{level:"weak",width:"33%",text:"弱"}:e<=4?{level:"medium",width:"66%",text:"中等"}:{level:"strong",width:"100%",text:"强"}}),B=async t=>{t&&t.preventDefault(),!(!$.value||!g.identifier)&&await $.value.validate(e=>{e&&(u.value=!0,setTimeout(()=>{u.value=!1;const a=g.identifier;a.includes("@")?U.value=a.replace(/(.{2}).*(@.*)/,"$1***$2"):U.value=a.replace(/(.{2}).*(.{2})/,"$1***$2"),R.success("验证码已发送"),r.value=2,N()},1e3))})},X=async()=>{E.value&&await E.value.validate(t=>{t&&(u.value=!0,setTimeout(()=>{u.value=!1,C.code==="123456"?(R.success("验证码正确"),r.value=3):(R.error("验证码错误，请重新输入"),d.value=["","","","","",""],C.code="",setTimeout(()=>{var e;(e=f.value[0])==null||e.focus()},100))},1e3))})},K=async()=>{S.value&&await S.value.validate(t=>{t&&(u.value=!0,setTimeout(()=>{u.value=!1,R.success("密码重置成功"),r.value=4},1500))})},Y=()=>{R.success("验证码已重新发送"),N()},N=()=>{k.value=60,D=setInterval(()=>{k.value--,k.value<=0&&clearInterval(D)},1e3)},j=()=>{Z.push("/login")};return te(r,t=>{setTimeout(()=>{if(t===1){const e=document.querySelector(".form-input input");e&&e.focus()}else t===2&&f.value[0]&&f.value[0].focus()},100)}),oe(()=>{setTimeout(()=>{const t=document.querySelector(".form-input input");t&&t.focus()},100)}),le(()=>{D&&clearInterval(D)}),(t,e)=>{const a=w("Lock"),i=w("el-icon"),P=w("User"),V=w("el-input"),c=w("el-form-item"),_=w("el-button"),q=w("el-form"),ee=w("CircleCheck");return y(),b("div",fe,[e[20]||(e[20]=s("div",{class:"geometric-bg"},[s("div",{class:"geo-shape geo-1"}),s("div",{class:"geo-shape geo-2"}),s("div",{class:"geo-shape geo-3"})],-1)),s("div",pe,[s("div",ve,[s("div",me,[s("div",ge,[s("div",_e,[o(i,{size:"28"},{default:l(()=>[o(a)]),_:1})]),e[7]||(e[7]=s("div",{class:"logo-text"},[s("h1",{class:"app-title"},[h(" Murk"),s("span",{style:{color:"#409EFF"}},"PHP"),h("加密 ")])],-1))])]),e[19]||(e[19]=s("div",{class:"form-header forgot-header"},[s("h2",null,"找回密码"),s("p",null,"重置您的账户密码")],-1)),s("div",we,[s("div",{class:m(["step",{active:r.value>=1,completed:r.value>1}])},e[8]||(e[8]=[s("div",{class:"step-number"},"1",-1),s("div",{class:"step-label"},"验证身份",-1)]),2),s("div",{class:m(["step-line",{active:r.value>1}])},null,2),s("div",{class:m(["step",{active:r.value>=2,completed:r.value>2}])},e[9]||(e[9]=[s("div",{class:"step-number"},"2",-1),s("div",{class:"step-label"},"验证码",-1)]),2),s("div",{class:m(["step-line",{active:r.value>2}])},null,2),s("div",{class:m(["step",{active:r.value>=3,completed:r.value>3}])},e[10]||(e[10]=[s("div",{class:"step-number"},"3",-1),s("div",{class:"step-label"},"重置密码",-1)]),2)]),s("div",ye,[r.value===1?(y(),b("div",be,[e[11]||(e[11]=s("div",{class:"form-header"},[s("h2",null,"验证您的身份"),s("p",null,"请输入您的用户名或邮箱地址")],-1)),o(q,{ref_key:"identityFormRef",ref:$,model:g,rules:O,class:"forgot-form",onSubmit:e[1]||(e[1]=M(()=>{},["prevent"]))},{default:l(()=>[o(c,{prop:"identifier"},{default:l(()=>[o(V,{modelValue:g.identifier,"onUpdate:modelValue":e[0]||(e[0]=F=>g.identifier=F),placeholder:"用户名或邮箱地址",size:"large",class:"form-input",onKeyup:L(B,["enter"])},{prefix:l(()=>[o(i,null,{default:l(()=>[o(P)]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(c,null,{default:l(()=>[o(_,{type:g.identifier?"primary":"info",size:"large",loading:u.value,disabled:!g.identifier,onClick:B,class:m(["submit-btn",{"btn-disabled":!g.identifier}])},{default:l(()=>[h(I(u.value?"验证中...":"下一步"),1)]),_:1},8,["type","loading","disabled","class"])]),_:1})]),_:1},8,["model"])])):z("",!0),r.value===2?(y(),b("div",he,[s("div",ke,[e[12]||(e[12]=s("h2",null,"输入验证码",-1)),s("p",null,"验证码已发送至 "+I(U.value),1)]),o(q,{ref_key:"codeFormRef",ref:E,model:C,rules:Q,class:"forgot-form",onSubmit:e[3]||(e[3]=M(()=>{},["prevent"]))},{default:l(()=>[o(c,{prop:"code"},{default:l(()=>[s("div",Ce,[(y(!0),b(ae,null,re(d.value,(F,x)=>de((y(),b("input",{key:x,ref_for:!0,ref:p=>f.value[x]=p,"onUpdate:modelValue":p=>d.value[x]=p,type:"text",maxlength:"1",class:"code-digit-input",onInput:p=>H(x,p),onKeydown:p=>G(x,p),onPaste:e[2]||(e[2]=p=>J(p))},null,40,Pe)),[[ue,d.value[x]]])),128))])]),_:1}),s("div",Ve,[o(_,{type:"text",disabled:k.value>0,onClick:Y,class:"resend-btn"},{default:l(()=>[h(I(k.value>0?`${k.value}秒后重发`:"重新发送"),1)]),_:1},8,["disabled"])])]),_:1},8,["model"])])):z("",!0),r.value===3?(y(),b("div",Fe,[e[14]||(e[14]=s("div",{class:"form-header"},[s("h2",null,"设置新密码"),s("p",null,"请设置一个安全的新密码")],-1)),o(q,{ref_key:"passwordFormRef",ref:S,model:n,rules:W,class:"forgot-form",onSubmit:e[6]||(e[6]=M(()=>{},["prevent"]))},{default:l(()=>[o(c,{prop:"password"},{default:l(()=>[o(V,{modelValue:n.password,"onUpdate:modelValue":e[4]||(e[4]=F=>n.password=F),type:"password",placeholder:"新密码",size:"large","show-password":"",class:"form-input",onKeyup:L(K,["enter"])},{prefix:l(()=>[o(i,null,{default:l(()=>[o(a)]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(c,{prop:"confirmPassword"},{default:l(()=>[o(V,{modelValue:n.confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=F=>n.confirmPassword=F),type:"password",placeholder:"确认新密码",size:"large","show-password":"",class:"form-input",onKeyup:L(K,["enter"])},{prefix:l(()=>[o(i,null,{default:l(()=>[o(a)]),_:1})]),_:1},8,["modelValue"])]),_:1}),s("div",xe,[e[13]||(e[13]=s("div",{class:"strength-label"},"密码强度：",-1)),s("div",Ie,[s("div",{class:m(["strength-fill",T.value.level]),style:ie({width:T.value.width})},null,6)]),s("div",{class:m(["strength-text",T.value.level])},I(T.value.text),3)]),o(c,null,{default:l(()=>[o(_,{type:n.password&&n.confirmPassword?"primary":"info",size:"large",loading:u.value,disabled:!n.password||!n.confirmPassword,onClick:K,class:m(["submit-btn",{"btn-disabled":!n.password||!n.confirmPassword}])},{default:l(()=>[h(I(u.value?"重置中...":"重置密码"),1)]),_:1},8,["type","loading","disabled","class"])]),_:1})]),_:1},8,["model"])])):z("",!0),r.value===4?(y(),b("div",ze,[s("div",Re,[o(i,{size:"64",color:"#67c23a"},{default:l(()=>[o(ee)]),_:1})]),e[16]||(e[16]=s("div",{class:"success-header"},[s("h2",null,"密码重置成功"),s("p",null,"您的密码已成功重置，请使用新密码登录")],-1)),o(_,{type:"primary",size:"large",onClick:j,class:"submit-btn"},{default:l(()=>e[15]||(e[15]=[h(" 返回登录 ",-1)])),_:1,__:[15]})])):z("",!0),r.value<4?(y(),b("div",De,[s("div",Te,[e[18]||(e[18]=h(" 记起密码了？ ",-1)),o(_,{type:"text",onClick:j,class:"login-btn"},{default:l(()=>e[17]||(e[17]=[h(" 返回登录 ",-1)])),_:1,__:[17]})])])):z("",!0)])])])])}}},qe=ce($e,[["__scopeId","data-v-ff8824ba"]]);export{qe as default};
